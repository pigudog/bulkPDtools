不论是快捷键还是菜单，本质上都是调用 devtools 包中的`document()`函数和`build()`函数。

学会使用命令封装非常重要，因为有一些信息仅在使用命令的时候才会给出。

-   写入注释：`devtools::document()`

-   建包：`devtools::build()`

使用命令封装包后的信息，不会再 Build 窗口中显示，而是在控制台中显示。

```{r}
# 写入注释
devtools::document()
```

```{r}
# 建包
devtools::build()
```

封装完R包后，我们就可以使用`library()`命令来调用我们的包啦！

没有任何报错信息，说明 PDtools 包制作成功。

在 Package 窗口中，也可以找到我们的 PDtools 包

现在我们已经学会如何创建、封装R包了，但是 xmypkg 还只是个空包，没有任何内容，不过一般在封装包之前，大家肯定就已经把函数搞定啦，所以这里就不讲解创建函数的过程了，让我们直接进入函数注释部分！

函数注释需要用到roxygen2 ！！！！！

双击打开我们的项目文件 xmypkg.Rproj。

首先，我们写1个标准函数，并将它**保存在R文件夹**下，文件名为XXX.R，R语言代码文件的**扩展名必须是R**，而文件名不一定要和函数名一样，可以是XXXO.R，也可以是XX.R，但不能是中文。

```{r}
# eg.
add <- function(x, y){
  x + y
}
```

插入注释框架主要有2种方法：菜单插入、快捷键插入，不管哪一种，都要先将**光标定位在函数内部**，只有在函数内部，RStudio才能识别这是1个函数。

首先，将光标定位在函数内部，然后依次点击菜单栏的 Code、Insert Roxygen Skeleton，就插入了注释框架

或者使用使用快捷键 Ctrl+Alt+Shift+R 即可插入

。 我们使用 usethis 包中的`use_package()`函数来指定引用包，`use_package()`函数中总共有3个参数package、type 和 min_version，package 表示我们要引用包的名称，type 表示引用的类型，常用的引用类型有 Imports、Depends 和 Suggests，min_version 表示包的最小版本号。

例如，在 xmypkg 包引用 stats 包，那么 package 就等于"stats"。

如果我们只需要使用 stats 包中的某个函数，而不是整个 stats 包，那么引用类型就是 Imports，命令如下：

```{r}
usethis::use_package(package = "stats", type = "Imports")
```

我们看到 Adding "stats" to Imports field in DESCRIPTION，意思是将 stats 包添加在 DESCRIPTION 文件中的 Imports 部分，打开 DESCRIPTION 文件，可以看到多了 Imports 部分，而且下面有 stats。

如果我们需要使用整个 stats 包，也就是 xmypkg 包功能的实现完全依赖于 stats 包，而不是仅仅使用某个函数，type 等于"Depends"，命令如下：

```{r}
usethis::use_package(package = "stats", type = "Suggests")
```

stats 被从 Imports 转移到了 Depends 部分，并且告诉我们尽量不用使用 Depends，Imports 是最多且更好的选择。之所以有这样的建议，那是因为当 xmypkg 包对 stats 的关系是 Depends 时，`library(xmypkg)`时，会同时`library(stats)`，这样就增加了函数名称冲突的风险，而当 xmypkg 包对 stats 的关系是 Imports，`library(xmypkg)`包的时候，不会运行`library(stats)`，也就不会载入 stats 包，从而避免了不必要的函数名冲突，仅引用我们引用的函数。

如果 xmypkg 包对 stats 包没有引用和依赖关系，仅仅在例子中使用了该包，那么我们会建议安装这个包，来实现我们的例子，这个时候的关系是"建议"，type 等于"Suggests"

所以，DESCRIPTION文件中的 **Imports、Depends 和 Suggests 分别表示：引用、依赖和建议**

单独使用 Imports、Depends 和 Suggests 引用的都是 CRAN 上的包，如果想引用 Bioconductor 上的包，需要在前面加上 **biocViews:** ，例如，我们想在 xmypkg 包中引用 limma 包，我们需要将 limma 写在 Imports 下面，并在 Imports 前加 biocViews:

# 引用函数

引用包是引用函数的前提，如果想引用某个函数，必须先引用该函数所属的R包。引用函数有2种形式：通过 双引号:: 直接引用；通过 roxygen2 注释引用。

例如，我们要引用do包中的join_inner函数，通过双引号来引用的方式为`do::join_inner()`；通过注释来引用的方式为`#' @importFrom do join_inner`。

# DESCRIPTION

DESCRIPTION 文件是 R 包的说明文件，使用者通过阅读该文件，可以快速了解你的 R 包，DESCRIPTION **主要包含**了**标题、说明、作者、通讯方式、版本号**等几个部分，现在我们来介绍一下如何撰写 DESCRIPTION 文件。

# 实操

```{r}
usethis::use_package(package = "ggplot2", type = "Depends")
```

```{r}
usethis::use_package(package = "dplyr", type = "Depends")
```

```{r}
usethis::use_pipe(export=TRUE)
```
